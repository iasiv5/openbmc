## Plan: Git仓库经验教训系统（meta-iasi MVP）

目标是在不打断现有开发流程的前提下，为 meta-iasi 建立结构化 Lesson Learned 体系，并通过根目录 AGENTS.md 做渐进式提示注入。方案采用“轻量规范 + 元数据标准 + 自动校验 + 审阅责任映射”，先实现最小可行范围，再按阶段扩展到更大范围。

**Steps**
1. Phase 0｜基线与边界冻结（阻塞后续）
   - 固化范围：仅覆盖 meta-iasi 及仓库根治理入口，不修改第三方导入层。
   - 固化流程：GitHub PR 为主，兼容 git 直接提交；不改变现有构建/发布流程。
   - 固化分级：仓内敏感分级采用 public/internal/confidential 标签机制。

2. Phase 1｜信息架构与渐进式披露设计（依赖 1）
   - 在仓库根建立知识入口目录（建议 docs/lessons/）与分层导航：
     - L0：一页索引（按主题/组件/严重度/时效）
     - L1：Checklist 与贡献流程
     - L2：结构化 Lesson 条目
     - L3：深度复盘附件（可选，按分级控制）
   - 定义“渐进式披露”原则：默认只展示摘要与适用场景，详细根因/修复路径按需要下钻。
   - 设计 taxonomy：component、topic、failure-mode、lifecycle、impact、confidence。

3. Phase 2｜元数据标准与模板落地（依赖 2）
   - 制定统一 frontmatter schema（YAML）最小字段：
     - id, title, date, component, tags, symptoms, root_cause, fix, prevention, owner, status, sensitivity, applicability, links
   - 提供两类模板：
     - quick-lesson（轻量经验，5分钟可填）
     - deep-lesson（问题复盘，含验证与回归信息）
   - 提供 Lesson Learn Checklist：创建前检查、提交前检查、合并后维护检查。

4. Phase 3｜AGENTS.md 全局注入策略（依赖 2，可与 3 并行）
   - 在仓库根创建 AGENTS.md，声明：
     - 何时读取 lessons 索引
     - 如何按 metadata 过滤（组件、场景、敏感级）
     - 回答时优先引用“摘要→条目→深度附件”的层级路径
   - 将高频规则放 AGENTS.md，细分规则放 docs/lessons 下，减少会话上下文占用。

5. Phase 4｜自动化校验与检索优化（依赖 3）
   - 增加轻量校验脚本（建议 scripts/lessons/）：
     - frontmatter 必填项校验
     - taxonomy 枚举校验
     - 链接有效性与重复 id 检查
     - 敏感词/密钥模式扫描（阻断明显泄露）
   - 增加检索索引产物（可由脚本生成）：
     - lessons index（按标签、组件、日期排序）
     - checklist 覆盖率统计

6. Phase 5｜Git 工作流无缝集成（依赖 4）
   - 在 PR 模板增加可选条目：
     - 是否新增/更新 lesson
     - 若否，说明原因（无通用价值/已覆盖）
   - 审阅责任映射：复用 OWNERS，新增“lesson reviewer”约定（文档层面）。
   - 约束“最小侵入”：lesson 变更与代码变更可同 PR，也可后续补 PR，不阻塞紧急修复。

7. Phase 6｜权限控制与发布策略（依赖 3,5）
   - 仓内执行分级访问规则：
     - public：可公开细节
     - internal：脱敏后公开，细节仅保留必要信息
     - confidential：仅保留摘要和处置结论，不放敏感细节
   - 对 confidential 条目制定“外部引用禁令”和“最小披露模板”。

8. Phase 7｜运行手册与维护规范（依赖 5,6）
   - 发布贡献指南：如何创建、更新、归档 lesson；何时升级 quick → deep。
   - 发布维护 SLA：
     - 新增：问题关闭后 3 个工作日内补录
     - 回顾：每月清理 stale 条目与重复条目
   - 定义度量指标：检索命中率、重复问题率、MTTR 变化、onboarding 时间变化。

**Relevant files**
- /home/iasi/workspace/openbmc/AGENTS.md — 全局提示注入入口与分层读取策略
- /home/iasi/workspace/openbmc/.github/pull_request_template.md — 增加 lesson 关联检查项
- /home/iasi/workspace/openbmc/OWNERS — 复用审阅责任映射（不强制改动，先文档约定）
- /home/iasi/workspace/openbmc/README.md — 增加 lesson 系统入口链接
- /home/iasi/workspace/openbmc/docs/lessons/README.md — 索引、taxonomy、披露层级说明
- /home/iasi/workspace/openbmc/docs/lessons/checklist.md — Lesson Learn Checklist
- /home/iasi/workspace/openbmc/docs/lessons/templates/quick-lesson.md — 轻量模板
- /home/iasi/workspace/openbmc/docs/lessons/templates/deep-lesson.md — 深度模板
- /home/iasi/workspace/openbmc/scripts/lessons/validate_lessons.py — 元数据与敏感内容校验
- /home/iasi/workspace/openbmc/scripts/lessons/build_index.py — 生成检索索引

**Verification**
1. 结构验证：新增示例 lesson 2 条（quick + deep），确认索引可导航且层级披露符合预期。
2. 元数据验证：运行 validate_lessons，覆盖必填字段、枚举合法性、重复 id、断链检测。
3. 安全验证：向示例中注入模拟敏感字符串，确认扫描规则拦截并给出定位。
4. 工作流验证：发起一次示例 PR（代码 + lesson），确认模板提示、审阅路径、合并体验无阻塞。
5. 检索验证：按 component/tags/date 查询，确认 3 步内可定位到目标经验。
6. 维护验证：执行一次月度清理演练，验证归档流程与状态流转可操作。

**Decisions**
- 范围：先做 meta-iasi MVP，不扩展到第三方导入层。
- 流程：GitHub PR 为主，兼容 git 直接提交。
- 安全：仓内采用敏感分级，不引入分仓。
- 自动化：MVP 即引入轻量校验脚本。
- 注入点：AGENTS.md 放仓库根目录。

**Further Considerations**
1. PR gate 强度：Option A 警告不阻断（推荐MVP）；Option B 缺字段阻断；Option C 阶段性升级（先A后B）。
2. taxonomy 深度：Option A 10-15 个枚举值（推荐）；Option B 按组件自定义；Option C 混合（核心枚举 + 扩展标签）。
3. confidential 处理：Option A 仅摘要入仓（推荐）；Option B 允许加密附件；Option C 仅记录外部编号。